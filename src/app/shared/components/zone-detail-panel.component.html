<div class="h-full bg-white flex flex-col" *ngIf="zoneId()">
  <!-- Header -->
  <div class="p-4 border-b border-slate-200 flex items-center justify-between">
    <h3 class="text-lg font-semibold text-slate-900">Zone Details</h3>
    <button (click)="onClose()" class="p-1 hover:bg-slate-100 rounded transition-colors">
      <mat-icon class="!text-xl !w-5 !h-5 !leading-5">close</mat-icon>
    </button>
  </div>

  <!-- Tabs -->
  <!-- Tabs -->
  <div class="border-b border-slate-200 bg-white">
    <div class="flex">
      <button
        *ngFor="let tab of tabs"
        (click)="activeTab.set(tab.id)"
        class="flex-1 px-3 py-3 text-sm font-medium transition-colors border-b-2 min-w-0"
        [ngClass]="{
          'border-blue-600 text-blue-600': activeTab() === tab.id,
          'border-transparent text-slate-600 hover:text-slate-900': activeTab() !== tab.id,
        }"
      >
        <div class="flex items-center justify-center gap-1.5">
          <mat-icon class="!text-base !w-4 !h-4 !leading-4">{{ tab.icon }}</mat-icon>
          <span class="truncate">{{ tab.label }}</span>
        </div>
      </button>
    </div>
  </div>

  <!-- Content -->
  <div class="flex-1 overflow-y-auto p-4">
    <!-- Summary Tab -->
    <div *ngIf="activeTab() === 'summary'" class="space-y-6">
      <!-- Zone Name -->
      <div>
        <div class="text-xs font-medium text-slate-500 uppercase tracking-wide mb-2">Zone</div>
        <div class="text-xl font-semibold text-slate-900">{{ zoneName() }}</div>
      </div>

      <!-- State -->
      <div>
        <div class="text-xs font-medium text-slate-500 uppercase tracking-wide mb-2">State</div>
        <div
          class="inline-flex items-center gap-2 px-3 py-1 rounded-full text-sm font-medium"
          [ngClass]="getStateClass()"
        >
          <div class="w-2 h-2 rounded-full" [ngClass]="getStateDotClass()"></div>
          <span>{{ getStateLabel() }}</span>
        </div>
      </div>

      <!-- Active Incidents -->
      <div>
        <div class="text-xs font-medium text-slate-500 uppercase tracking-wide mb-2">
          Active Incidents
        </div>
        <div class="text-3xl font-bold text-slate-900">{{ activeIncidentCount() }}</div>

        <!-- Incident List -->
        <div *ngIf="activeIncidentCount() > 0" class="mt-3 space-y-2">
          <div
            *ngFor="let incident of zoneIncidents()"
            class="p-3 rounded-lg border"
            [ngClass]="{
              'bg-red-50 border-red-200': incident.anomaly.severity === 'critical',
              'bg-orange-50 border-orange-200': incident.anomaly.severity === 'high',
              'bg-yellow-50 border-yellow-200': incident.anomaly.severity === 'medium',
              'bg-blue-50 border-blue-200': incident.anomaly.severity === 'low',
            }"
          >
            <div class="flex items-start justify-between">
              <div class="flex-1">
                <div class="text-sm font-medium text-slate-900">
                  {{ formatSensorType(incident.anomaly.sensor_type) }} Alert
                </div>
                <div class="text-xs text-slate-600 mt-1">
                  Value: {{ incident.measurement.measurement_value.toFixed(2) }}
                  {{ incident.measurement.measurement_type }}
                </div>
                <div class="text-xs font-medium text-slate-700 mt-2">
                  Action: {{ incident.requiredAction }}
                </div>
                <div class="text-xs text-slate-500 mt-1">
                  {{ formatTimestamp(incident.anomaly.timestamp) }}
                </div>
              </div>
              <div class="ml-2">
                <span
                  class="text-xs font-medium px-2 py-1 rounded"
                  [ngClass]="{
                    'bg-red-100 text-red-800': incident.anomaly.severity === 'critical',
                    'bg-orange-100 text-orange-800': incident.anomaly.severity === 'high',
                    'bg-yellow-100 text-yellow-800': incident.anomaly.severity === 'medium',
                    'bg-blue-100 text-blue-800': incident.anomaly.severity === 'low',
                  }"
                >
                  {{ incident.anomaly.severity }}
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Recent Measurements -->
      <div>
        <div class="text-xs font-medium text-slate-500 uppercase tracking-wide mb-2">
          Recent Measurements
        </div>
        <div *ngIf="recentMeasurement(); let measurement" class="space-y-2">
          <div class="flex items-center justify-between p-3 bg-slate-50 rounded-lg">
            <div>
              <div class="text-sm font-medium text-slate-900">
                {{ formatMeasurementType(measurement.measurement_type) }}
              </div>
              <div class="text-xs text-slate-600 mt-1">
                {{ formatTimestamp(measurement.timestamp) }}
              </div>
            </div>
            <div class="text-right">
              <div class="text-lg font-semibold text-slate-900">
                {{ formatMeasurementValue(measurement) }}
              </div>
            </div>
          </div>
        </div>
        <div *ngIf="!recentMeasurement()" class="text-sm text-slate-500">
          No recent measurements
        </div>
      </div>
    </div>

    <!-- Signals Tab -->
    <div *ngIf="activeTab() === 'signals'" class="space-y-4">
      <div class="text-sm text-slate-600 mb-4">Historical sensor data for this zone</div>

      <div *ngFor="let measurement of zoneMeasurements()" class="p-3 bg-slate-50 rounded-lg">
        <div class="flex items-center justify-between">
          <div class="flex-1">
            <div class="text-sm font-medium text-slate-900">
              {{ formatMeasurementType(measurement.measurement_type) }}
            </div>
            <div class="text-xs text-slate-600 mt-1">Sensor: {{ measurement.sensor_id }}</div>
            <div class="text-xs text-slate-500 mt-1">
              {{ formatTimestamp(measurement.timestamp) }}
            </div>
          </div>
          <div class="text-right">
            <div class="text-lg font-semibold text-slate-900">
              {{ formatMeasurementValue(measurement) }}
            </div>
          </div>
        </div>
      </div>

      <div *ngIf="zoneMeasurements().length === 0" class="text-center py-8 text-slate-500">
        No historical data available
      </div>
    </div>

    <!-- Replay Tab -->
    <div *ngIf="activeTab() === 'replay'" class="space-y-4">
      <div class="text-sm text-slate-600 mb-4">Time-based replay of incidents and measurements</div>

      <div class="text-center py-12 text-slate-500">
        <mat-icon class="!text-[48px] !w-12 !h-12 mx-auto mb-3 text-slate-400"
          >play_circle</mat-icon
        >
        <p>Replay functionality coming soon</p>
      </div>
    </div>

    <!-- AI Explanation Tab -->
    <div *ngIf="activeTab() === 'ai'" class="space-y-4">
      <div class="text-sm text-slate-600 mb-4">AI-powered insights and recommendations</div>

      <div class="text-center py-12 text-slate-500">
        <mat-icon class="!text-[48px] !w-12 !h-12 mx-auto mb-3 text-slate-400"
          >auto_awesome</mat-icon
        >
        <p>AI explanation functionality coming soon</p>
      </div>
    </div>
  </div>
</div>

<!-- Empty State -->
<div *ngIf="!zoneId()" class="h-full flex items-center justify-center text-slate-500">
  <div class="text-center">
    <mat-icon class="!text-[48px] !w-12 !h-12 mx-auto mb-3 text-slate-300">location_on</mat-icon>
    <p>Select a zone to view details</p>
  </div>
</div>
