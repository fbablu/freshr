<!-- src/app/shared/components/social-signals.component.html -->
<div class="h-full flex flex-col">
  <!-- View Mode Toggle (inside accordion) -->
  <div class="px-4 py-2 border-b border-slate-100 bg-slate-50/50">
    <div class="flex items-center justify-between">
      <p class="text-xs text-slate-500">Twitter & Yelp monitoring</p>
      <div class="flex items-center gap-1">
        <button
          *ngFor="let mode of viewModes"
          (click)="viewMode.set(mode.id)"
          class="px-2 py-1 text-xs rounded transition-colors"
          [ngClass]="{
            'bg-blue-100 text-blue-700': viewMode() === mode.id,
            'text-slate-600 hover:bg-slate-100': viewMode() !== mode.id,
          }"
        >
          {{ mode.label }}
        </button>
      </div>
    </div>
  </div>

  <!-- Content -->
  <div class="flex-1 overflow-y-auto p-4">
    <!-- Loading -->
    <div *ngIf="loading()" class="text-center py-6">
      <mat-icon class="!text-[24px] !w-6 !h-6 mx-auto mb-2 text-blue-500 animate-spin"
        >sync</mat-icon
      >
      <p class="text-xs text-slate-500">Loading signals...</p>
    </div>

    <!-- Signals View -->
    <div *ngIf="!loading() && viewMode() === 'signals'" class="space-y-2">
      <div
        *ngFor="let signal of signals().slice(0, 4)"
        class="p-2.5 rounded-lg border"
        [ngClass]="{
          'bg-red-50 border-red-200/50': signal.severity === 'outbreak',
          'bg-orange-50 border-orange-200/50': signal.severity === 'confirmed',
          'bg-yellow-50 border-yellow-200/50': signal.severity === 'escalating',
          'bg-slate-50 border-slate-200/50': signal.severity === 'early_signal',
        }"
      >
        <!-- Header -->
        <div class="flex items-center justify-between mb-1.5">
          <div class="flex items-center gap-1.5">
            <span
              class="px-1.5 py-0.5 text-[10px] font-medium rounded"
              [ngClass]="{
                'bg-blue-100 text-blue-700': signal.platform === 'twitter',
                'bg-red-100 text-red-700': signal.platform === 'yelp',
              }"
            >
              {{ signal.platform === 'twitter' ? 'ùïè' : '‚òÖ' }}
            </span>
            <span class="text-[10px] text-slate-500">{{ signal.relative_time }}</span>
          </div>
          <span
            class="text-[10px] font-medium px-1.5 py-0.5 rounded"
            [ngClass]="{
              'bg-red-200 text-red-800': signal.severity === 'outbreak',
              'bg-orange-200 text-orange-800': signal.severity === 'confirmed',
              'bg-yellow-200 text-yellow-800': signal.severity === 'escalating',
              'bg-slate-200 text-slate-700': signal.severity === 'early_signal',
            }"
          >
            {{ formatSeverity(signal.severity) }}
          </span>
        </div>

        <!-- Author & Content -->
        <div class="text-[11px] font-medium text-slate-700 mb-0.5">
          {{ signal.author }}
          <span *ngIf="signal.rating" class="text-slate-400">({{ signal.rating }}‚òÖ)</span>
        </div>
        <p class="text-xs text-slate-800 line-clamp-2">{{ signal.content }}</p>

        <!-- Keywords -->
        <div class="flex flex-wrap gap-1 mt-1.5">
          <span
            *ngFor="let keyword of (signal.keywords || []).slice(0, 3)"
            class="px-1 py-0.5 text-[10px] bg-slate-200/70 text-slate-600 rounded"
          >
            {{ keyword }}
          </span>
        </div>
      </div>

      <div *ngIf="signals().length === 0" class="text-center py-6 text-slate-400">
        <mat-icon class="!text-[24px] !w-6 !h-6 mx-auto mb-1">speaker_notes_off</mat-icon>
        <p class="text-xs">No signals detected</p>
      </div>
    </div>

    <!-- Timeline View -->
    <div *ngIf="!loading() && viewMode() === 'timeline'" class="space-y-2">
      <div class="relative">
        <div class="absolute left-3 top-0 bottom-0 w-0.5 bg-slate-200"></div>

        <div *ngFor="let event of timeline().slice(0, 5)" class="relative pl-8 pb-3">
          <div
            class="absolute left-1.5 w-2.5 h-2.5 rounded-full border-2 border-white"
            [ngClass]="{
              'bg-red-500': event.type === 'anomaly',
              'bg-blue-500': event.type === 'social',
            }"
          ></div>
          <div
            class="rounded-lg p-2"
            [ngClass]="{
              'bg-red-50': event.type === 'anomaly',
              'bg-blue-50': event.type === 'social',
            }"
          >
            <div class="flex items-center justify-between mb-0.5">
              <span class="text-[10px] font-medium text-slate-500">{{ event.source }}</span>
              <span
                class="text-[10px] px-1 py-0.5 rounded"
                [ngClass]="{
                  'bg-red-200 text-red-700':
                    event.severity === 'critical' || event.severity === 'outbreak',
                  'bg-orange-200 text-orange-700':
                    event.severity === 'high' || event.severity === 'confirmed',
                  'bg-yellow-200 text-yellow-700': event.severity === 'medium',
                }"
              >
                {{ event.severity }}
              </span>
            </div>
            <p class="text-xs text-slate-800 line-clamp-2">{{ event.content }}</p>
          </div>
        </div>
      </div>

      <div *ngIf="timeline().length === 0" class="text-center py-6 text-slate-400">
        <mat-icon class="!text-[24px] !w-6 !h-6 mx-auto mb-1">timeline</mat-icon>
        <p class="text-xs">No timeline events</p>
      </div>
    </div>

    <!-- Insight View -->
    <div *ngIf="!loading() && viewMode() === 'insight'" class="space-y-3">
      <div *ngIf="correlation()?.correlation" class="space-y-3">
        <!-- Key Insight -->
        <div class="p-3 bg-blue-50 border border-blue-200/50 rounded-lg">
          <div class="flex items-start gap-2">
            <mat-icon class="!text-[18px] !w-[18px] !h-[18px] text-blue-600 mt-0.5"
              >lightbulb</mat-icon
            >
            <div>
              <h4 class="text-xs font-semibold text-blue-900 mb-0.5">Key Insight</h4>
              <p class="text-xs text-blue-800 leading-relaxed">
                {{ correlation()?.insight }}
              </p>
            </div>
          </div>
        </div>

        <!-- Metrics -->
        <div class="grid grid-cols-2 gap-2">
          <div class="p-2 bg-green-50 rounded-lg">
            <div class="text-[10px] text-green-600 font-medium">FRESHR DETECTION</div>
            <div class="text-sm font-bold text-green-900">
              {{ correlation()?.correlation?.anomaly_detection_time }}
            </div>
          </div>
          <div class="p-2 bg-orange-50 rounded-lg">
            <div class="text-[10px] text-orange-600 font-medium">SOCIAL SIGNAL</div>
            <div class="text-sm font-bold text-orange-900">
              {{ correlation()?.correlation?.first_social_signal }}
            </div>
          </div>
        </div>

        <!-- Lead Time -->
        <div
          class="p-3 bg-gradient-to-r from-green-50 to-emerald-50 rounded-lg border border-green-200/50"
        >
          <div class="text-center">
            <div class="text-[10px] text-green-600 font-medium mb-0.5">FRESHR ADVANTAGE</div>
            <div class="text-xl font-bold text-green-700">
              {{ correlation()?.correlation?.freshr_advantage }}
            </div>
            <p class="text-[10px] text-green-600 mt-0.5">before public reports</p>
          </div>
        </div>
      </div>

      <div *ngIf="!correlation()?.correlation" class="text-center py-6 text-slate-400">
        <mat-icon class="!text-[24px] !w-6 !h-6 mx-auto mb-1">analytics</mat-icon>
        <p class="text-xs">No correlation data</p>
      </div>
    </div>
  </div>
</div>
